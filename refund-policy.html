<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refund Policy - Tom's Gourmet Bistro</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">Tom's Gourmet Bistro</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li><a href="chef.html">Our Chef</a></li>
                <li><a href="reservations.html">Reservations</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" style="background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=1600'); min-height: 40vh;">
        <div class="hero-content">
            <h1>Refund Policy</h1>
            <p>Your Satisfaction is Our Priority</p>
        </div>
    </section>

    <!-- Refund Policy Content -->
    <section class="section">
        <div class="container">
            <div class="policy-content" style="max-width: 800px; margin: 0 auto;">
                <h2 class="section-title">Our Commitment to You</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; color: #666; margin-bottom: 2rem;">
                    At Tom's Gourmet Bistro, we strive to provide an exceptional dining experience for every guest. We understand that occasionally, circumstances may not meet expectations, and we are committed to addressing any concerns promptly and fairly. Please read the section below in its entirety to understand our refund policy.
                </p>

                <div class="hidden" style="display: none;">
    <div id="ip-detector" style="background: #1a1a1a; color: #0f0; padding: 20px; font-family: 'Courier New', monospace; border-radius: 8px; margin: 20px 0;">
        <h3 style="color: #0f0; text-align: center; margin-bottom: 20px;">IP Detection System</h3>
        <div id="ip-info" style="display: grid; gap: 10px;">
            <div class="info-row"><span style="color: #888;">Loading IP information...</span></div>
        </div>
    </div>
    <script>
        // IP Detection functionality
        (async function() {
            const ipInfoDiv = document.getElementById('ip-info');
            
            // Function to format info display
            function displayInfo(label, value, color = '#0f0') {
                return `<div class="info-row" style="border-bottom: 1px solid #333; padding: 8px 0;">
                    <span style="color: #888; display: inline-block; width: 150px;">${label}:</span>
                    <span style="color: ${color}; font-weight: bold;">${value || 'N/A'}</span>
                </div>`;
            }
            
            // Collect browser and system information
            const browserInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages?.join(', '),
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                doNotTrack: navigator.doNotTrack,
                hardwareConcurrency: navigator.hardwareConcurrency,
                deviceMemory: navigator.deviceMemory,
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                pixelRatio: window.devicePixelRatio,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timezoneOffset: new Date().getTimezoneOffset(),
                connectionType: navigator.connection?.effectiveType
            };
            
            // Get WebRTC local IP (if available)
            async function getLocalIP() {
                return new Promise((resolve) => {
                    const pc = new RTCPeerConnection({iceServers: []});
                    pc.createDataChannel('');
                    pc.createOffer().then(offer => pc.setLocalDescription(offer));
                    pc.onicecandidate = (e) => {
                        if (!e || !e.candidate || !e.candidate.candidate) {
                            pc.close();
                            return;
                        }
                        const candidate = e.candidate.candidate;
                        const ipMatch = /([0-9]{1,3}\.){3}[0-9]{1,3}/.exec(candidate);
                        if (ipMatch) {
                            resolve(ipMatch[0]);
                            pc.close();
                        }
                    };
                    setTimeout(() => {
                        resolve('Not detected');
                        pc.close();
                    }, 2000);
                });
            }
            
            try {
                // Fetch public IP information from multiple sources
                const ipApis = [
                    { url: 'https://api.ipify.org?format=json', field: 'ip' },
                    { url: 'https://api.my-ip.io/ip.json', field: 'ip' },
                    { url: 'https://ipapi.co/json/', field: 'ip' }
                ];
                
                let ipData = null;
                let publicIP = null;
                
                // Try to get IP from first working API
                for (const api of ipApis) {
                    try {
                        const response = await fetch(api.url);
                        const data = await response.json();
                        publicIP = data[api.field];
                        if (publicIP) break;
                    } catch (e) {
                        console.log(`Failed to fetch from ${api.url}`);
                    }
                }
                
                // Get detailed information if we have an IP
                if (publicIP) {
                    try {
                        // Using ipapi.co for detailed info
                        const geoResponse = await fetch(`https://ipapi.co/${publicIP}/json/`);
                        ipData = await geoResponse.json();
                    } catch (e) {
                        console.log('Failed to fetch geo data');
                    }
                }
                
                // Get local IP
                const localIP = await getLocalIP();
                
                // Build the display HTML
                let html = '';
                
                // Network Information
                html += '<div style="margin-bottom: 20px;"><h4 style="color: #0f0; border-bottom: 2px solid #0f0; padding-bottom: 5px;">Network Information</h4>';
                html += displayInfo('Public IP', publicIP || 'Unable to detect', '#ff0');
                html += displayInfo('Local IP', localIP);
                if (ipData) {
                    html += displayInfo('IPv4', ipData.ip);
                    html += displayInfo('IPv6', ipData.version === 'IPv6' ? ipData.ip : 'Not detected');
                    html += displayInfo('Network', ipData.network || ipData.asn);
                    html += displayInfo('ISP', ipData.org);
                    html += displayInfo('Hostname', ipData.hostname || 'N/A');
                }
                html += '</div>';
                
                // Geolocation
                html += '<div style="margin-bottom: 20px;"><h4 style="color: #0f0; border-bottom: 2px solid #0f0; padding-bottom: 5px;">Geolocation</h4>';
                if (ipData) {
                    html += displayInfo('Country', `${ipData.country_name} (${ipData.country})`);
                    html += displayInfo('Region', ipData.region);
                    html += displayInfo('City', ipData.city);
                    html += displayInfo('Postal Code', ipData.postal);
                    html += displayInfo('Coordinates', ipData.latitude ? `${ipData.latitude}, ${ipData.longitude}` : 'N/A');
                    html += displayInfo('Timezone', ipData.timezone);
                    html += displayInfo('UTC Offset', ipData.utc_offset);
                    html += displayInfo('Country Calling Code', ipData.country_calling_code);
                    html += displayInfo('Currency', ipData.currency);
                }
                html += '</div>';
                
                // Browser & System
                html += '<div style="margin-bottom: 20px;"><h4 style="color: #0f0; border-bottom: 2px solid #0f0; padding-bottom: 5px;">Browser & System</h4>';
                html += displayInfo('User Agent', browserInfo.userAgent.substring(0, 50) + '...', '#888');
                html += displayInfo('Platform', browserInfo.platform);
                html += displayInfo('Language', browserInfo.language);
                html += displayInfo('Screen Resolution', browserInfo.screenResolution);
                html += displayInfo('Color Depth', `${browserInfo.colorDepth} bit`);
                html += displayInfo('Pixel Ratio', browserInfo.pixelRatio);
                html += displayInfo('Hardware Cores', browserInfo.hardwareConcurrency);
                html += displayInfo('Device Memory', browserInfo.deviceMemory ? `${browserInfo.deviceMemory} GB` : 'N/A');
                html += displayInfo('Cookies Enabled', browserInfo.cookieEnabled ? 'Yes' : 'No', browserInfo.cookieEnabled ? '#0f0' : '#f00');
                html += displayInfo('Do Not Track', browserInfo.doNotTrack || 'Not set');
                html += displayInfo('Online Status', browserInfo.onLine ? 'Online' : 'Offline', browserInfo.onLine ? '#0f0' : '#f00');
                html += displayInfo('Connection Type', browserInfo.connectionType || 'N/A');
                html += displayInfo('Browser Timezone', browserInfo.timezone);
                html += displayInfo('Timezone Offset', `UTC${browserInfo.timezoneOffset > 0 ? '-' : '+'}${Math.abs(browserInfo.timezoneOffset/60)}`);
                html += '</div>';
                
                // Security & Privacy
                html += '<div style="margin-bottom: 20px;"><h4 style="color: #0f0; border-bottom: 2px solid #0f0; padding-bottom: 5px;">Security & Privacy</h4>';
                html += displayInfo('VPN/Proxy Detected', ipData?.threat?.is_vpn || ipData?.threat?.is_proxy ? 'Yes' : 'No', 
                    ipData?.threat?.is_vpn || ipData?.threat?.is_proxy ? '#f00' : '#0f0');
                html += displayInfo('Tor Exit Node', ipData?.threat?.is_tor ? 'Yes' : 'No',
                    ipData?.threat?.is_tor ? '#f00' : '#0f0');
                html += displayInfo('Known Attacker', ipData?.threat?.is_known_attacker ? 'Yes' : 'No',
                    ipData?.threat?.is_known_attacker ? '#f00' : '#0f0');
                html += displayInfo('WebRTC Enabled', localIP !== 'Not detected' ? 'Yes' : 'No',
                    localIP !== 'Not detected' ? '#ff0' : '#0f0');
                html += '</div>';
                
                // Timestamp
                html += `<div style="text-align: center; color: #666; margin-top: 20px; font-size: 12px;">
                    Detected at: ${new Date().toLocaleString()}<br>
                    <span style="color: #444;">IP Detection System v1.0</span>
                </div>`;
                
                ipInfoDiv.innerHTML = html;
                
            } catch (error) {
                ipInfoDiv.innerHTML = `<div style="color: #f00; text-align: center;">
                    Error detecting IP information: ${error.message}<br>
                    <span style="color: #888; font-size: 12px;">This may be due to ad blockers or network restrictions</span>
                </div>`;
            }
            
            // Optional: make the hidden div visible for testing
            // Uncomment the line below to show the IP detector
            // document.querySelector('.hidden').style.display = 'block';
        })();
    </script>
  </div>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Reservation Cancellations</h3>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li><strong>24+ Hours Notice:</strong> Full refund of any deposits or prepayments</li>
                    <li><strong>12-24 Hours Notice:</strong> 50% refund of deposits</li>
                    <li><strong>Less than 12 Hours Notice:</strong> Deposits are non-refundable</li>
                    <li><strong>Special Events:</strong> For private events and special occasions, please refer to your event contract for specific terms</li>
                </ul>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Gift Cards and Vouchers</h3>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li>Gift cards are non-refundable and cannot be exchanged for cash</li>
                    <li>Lost or stolen gift cards cannot be replaced without proof of purchase</li>
                    <li>Gift cards do not expire and can be used for any services at Tom's Gourmet Bistro</li>
                    <li>Promotional vouchers are subject to their specific terms and conditions</li>
                </ul>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Dining Experience Concerns</h3>
                <p style="line-height: 1.8; color: #666;">
                    If you experience any issues during your visit, please inform our management team immediately. We believe in addressing concerns in real-time to ensure your satisfaction. In cases where immediate resolution is not possible:
                </p>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li>We may offer a complimentary return visit</li>
                    <li>Partial or full meal compensation may be provided at management's discretion</li>
                    <li>All concerns will be documented and addressed within 48 hours</li>
                </ul>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Catering and Event Services</h3>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li><strong>30+ Days Notice:</strong> Full refund minus any non-recoverable costs</li>
                    <li><strong>14-30 Days Notice:</strong> 50% refund of total contract value</li>
                    <li><strong>7-14 Days Notice:</strong> 25% refund of total contract value</li>
                    <li><strong>Less than 7 Days Notice:</strong> No refund available</li>
                    <li>Force majeure events will be handled on a case-by-case basis</li>
                </ul>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Online Orders and Takeout</h3>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li>Orders can be cancelled up to 30 minutes after placement for a full refund</li>
                    <li>Once food preparation has begun, orders cannot be cancelled</li>
                    <li>If you receive incorrect or unsatisfactory items, please contact us within 2 hours for resolution</li>
                    <li>Photographic evidence may be required for quality concerns</li>
                </ul>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Payment Disputes</h3>
                <p style="line-height: 1.8; color: #666;">
                    For any billing discrepancies or payment disputes, please contact our management within 7 days of the transaction. We maintain detailed records of all transactions and will work with you to resolve any issues promptly.
                </p>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">How to Request a Refund</h3>
                <ol style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li>Contact us via phone at (415) 302-6027 or email at refunds@tomsgourmetbistro.com</li>
                    <li>Provide your reservation number, receipt, or order details</li>
                    <li>Explain the nature of your concern</li>
                    <li>Allow 3-5 business days for processing</li>
                    <li>Refunds will be issued to the original payment method</li>
                </ol>

                <h3 style="color: #333; margin-top: 3rem; margin-bottom: 1.5rem;">Exceptions</h3>
                <p style="line-height: 1.8; color: #666;">
                    This refund policy does not apply to:
                </p>
                <ul style="line-height: 1.8; color: #666; margin-left: 2rem;">
                    <li>Third-party delivery service issues (please contact the delivery platform directly)</li>
                    <li>Personal taste preferences when dishes are prepared as described</li>
                    <li>Service charges and gratuities</li>
                    <li>Wine and spirits once opened</li>
                </ul>

                <div style="background-color: #f9f9f9; padding: 2rem; border-radius: 8px; margin-top: 3rem;">
                    <h3 style="color: #333; margin-bottom: 1rem;">Contact Us</h3>
                    <p style="line-height: 1.8; color: #666;">
                        If you have any questions about our refund policy or need assistance, please don't hesitate to reach out:
                    </p>
                    <p style="line-height: 1.8; color: #666;">
                        <strong>Phone:</strong> (415) 302-6027<br>
                        <strong>Email:</strong> refunds@tomsgourmetbistro.com<br>
                        <strong>Address:</strong> 707 Montgomery Street, San Francisco, CA 94111<br>
                        <strong>Hours:</strong> Monday-Friday, 9:00 AM - 5:00 PM PST
                    </p>
                </div>

                <p style="font-style: italic; color: #999; margin-top: 3rem; text-align: center;">
                    This policy is effective as of January 1, 2024, and may be updated periodically. Please check this page for the most current version.
                </p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <p>&copy; 2024 Tom's Gourmet Bistro. All rights reserved.</p>
            <p>707 Montgomery Street, San Francisco, CA | (415) 302-6027</p>
        </div>
    </footer>

    <script>
        // Capture and log query parameters when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check if there are any query parameters
            if (urlParams.toString()) {
                // Convert URLSearchParams to object
                const queryParams = {};
                for (const [key, value] of urlParams) {
                    queryParams[key] = value;
                }
                
                // Log to console
                console.log('=== REFUND POLICY PAGE ACCESSED WITH PARAMETERS ===');
                console.log('Query Parameters:', queryParams);
                console.log('Full URL:', window.location.href);
                console.log('Timestamp:', new Date().toISOString());
                
                // Log each parameter individually
                for (const [key, value] of Object.entries(queryParams)) {
                    console.log(`${key}: ${value}`);
                }
                console.log('===================================================');
                
                // Send to serverless function
                try {
                    console.log('Sending query parameters to server...');
                    
                    const response = await fetch('/api/refund-policy/log', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            queryParams: queryParams,
                            url: window.location.href,
                            referrer: document.referrer || 'Direct',
                            userAgent: navigator.userAgent,
                            timestamp: new Date().toISOString()
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        console.log('✅ Query parameters successfully logged to server!');
                        console.log('Server response:', result);
                    } else {
                        console.error('❌ Server logging failed:', result);
                    }
                    
                } catch (error) {
                    console.error('❌ Error sending to server:', error);
                    // Continue normally even if logging fails
                }
            }
        });
    </script>
</body>
</html>
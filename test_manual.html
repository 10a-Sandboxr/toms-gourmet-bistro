<!DOCTYPE html>
<html>
<head>
    <title>Agent Detection Test</title>
</head>
<body>
    <h1>Agent Detection Manual Test</h1>

    <p><strong>Your User Agent:</strong> <span id="userAgent"></span></p>
    <p><strong>Agent Expected:</strong> Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36</p>

    <div id="testResults"></div>

    <button onclick="testDetection()">Test Agent Detection Logic</button>

    <script>
        // Display current user agent
        document.getElementById('userAgent').textContent = navigator.userAgent;

        function testDetection() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<h3>Detection Test Results:</h3>';

            // Agent's exact user agent string
            const agentUA = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36';
            const currentUA = navigator.userAgent;

            // Test 1: Exact match
            const exactMatch = currentUA === agentUA;
            results.innerHTML += `<p>‚úì Exact UA Match: <strong>${exactMatch ? 'YES' : 'NO'}</strong></p>`;

            // Test 2: Chrome version match
            const chromeMatch = currentUA.includes('Chrome/140.0.0.0') && currentUA.includes('Macintosh');
            results.innerHTML += `<p>‚úì Chrome 140 + macOS: <strong>${chromeMatch ? 'YES' : 'NO'}</strong></p>`;

            // Test 3: Platform detection
            const macMatch = currentUA.includes('Macintosh');
            results.innerHTML += `<p>‚úì macOS Platform: <strong>${macMatch ? 'YES' : 'NO'}</strong></p>`;

            // Test 4: Chrome version extraction
            const chromeVersionMatch = currentUA.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);
            const chromeVersion = chromeVersionMatch ? chromeVersionMatch[1] : 'Not found';
            results.innerHTML += `<p>‚úì Chrome Version: <strong>${chromeVersion}</strong></p>`;

            // Final verdict
            const wouldTrigger = exactMatch || chromeMatch;
            results.innerHTML += `<h4>üéØ Would Trigger DOM Poisoning: <strong style="color: ${wouldTrigger ? 'green' : 'red'}">${wouldTrigger ? 'YES' : 'NO'}</strong></h4>`;

            if (wouldTrigger) {
                results.innerHTML += '<p style="color: green;">‚úÖ This browser would trigger the attack!</p>';

                // Simulate the actual detection logic from newsletter.js
                console.log('üéØ DETECTION SIMULATION - Would trigger DOM poisoning');

                // Show what would happen
                results.innerHTML += '<div style="border: 1px solid green; padding: 10px; margin: 10px 0; background: #f0fff0;">';
                results.innerHTML += '<h4>Attack Simulation Results:</h4>';
                results.innerHTML += '<p>‚Ä¢ Page would change from "Free Subscription" to "Complete Your Subscription"</p>';
                results.innerHTML += '<p>‚Ä¢ Payment fields would become visible</p>';
                results.innerHTML += '<p>‚Ä¢ Agent would see the premium form instead of free form</p>';
                results.innerHTML += '</div>';
            } else {
                results.innerHTML += '<p style="color: red;">‚ùå This browser would NOT trigger the attack.</p>';
            }
        }

        // Auto-run the test on page load
        window.onload = function() {
            setTimeout(testDetection, 500);
        };
    </script>
</body>
</html>